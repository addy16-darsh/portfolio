<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Projects | Balagopal Portfolio</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    body { font-family: Arial, sans-serif; background-color: #0f0f0f; color: #fff; margin:0; padding:2rem; }
    h2 { text-align:center; margin-bottom:2rem; color:#fff; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
    .card { 
      background: #1a1a1a; border-radius: 12px; overflow: hidden; cursor: pointer; 
      display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100px;
      transition: transform 0.2s, box-shadow 0.2s; 
    }
    .card:hover { transform: scale(1.03); box-shadow: 0 0 15px #ff6a3d; }
    .card h3 { text-align:center; padding:0.5rem 0; margin:0; color:#fff; font-size:1.1rem; }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; z-index:10; overflow:auto; opacity:0; transition: opacity 0.3s ease; }
    .modal.show { display:flex; opacity:1; }
    .modal-content { background:#222; padding:2rem; border-radius:12px; max-width:700px; width:90%; color:#fff; position:relative; max-height:90vh; overflow-y:auto; }
    .modal-content img, .modal-content video { width:100%; border-radius:8px; margin-bottom:1rem; }
    .modal-content h3 { margin-top:0; color:#ff6a3d; }
    .modal-content ul { margin-left:1rem; margin-bottom:1rem; color:#fff; }
    .modal-content .tags { display:flex; flex-wrap:wrap; gap:0.5rem; margin-bottom:1rem; }
    .modal-content .tags span { background:#ff6a3d; color:#000; padding:2px 6px; border-radius:4px; font-size:0.8rem; }
    .close-btn { position:absolute; top:10px; right:15px; background:#ff6a3d; border:none; padding:5px 10px; border-radius:4px; cursor:pointer; color:#000; font-weight:bold; }
    .gallery-container { position:relative; }
    .gallery-nav { position:absolute; top:50%; transform:translateY(-50%); font-size:2rem; color:#ff6a3d; background:rgba(0,0,0,0.5); border:none; padding:5px 10px; cursor:pointer; border-radius:4px; }
    .prev { left:5px; }
    .next { right:5px; }
    .back-btn { display:inline-block; margin-bottom:1.5rem; color:#ff6a3d; border:1px solid #ff6a3d; padding:5px 10px; border-radius:4px; text-decoration:none; }
    .back-btn:hover { background:#ff6a3d; color:#fff; }
  </style>
</head>
<body>
  <a class="btn back-btn" href="{{ url_for('index') }}">‚Üê Back to Home</a>
  <h2>Projects</h2>

  <div class="grid">
    {% for proj in projects %}
      <div class="card" onclick="openModal({{ loop.index0 }})">
        <h3>{{ proj.title }}</h3>
      </div>
    {% endfor %}
  </div>

  <!-- Single Reusable Modal -->
  <div class="modal" id="project-modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">Back</button>
      <div id="gallery-container" class="gallery-container" style="display:none;">
        <img id="gallery-img" src="" alt="Project Image">
        <button class="gallery-nav prev" onclick="prevImage()">&#10094;</button>
        <button class="gallery-nav next" onclick="nextImage()">&#10095;</button>
      </div>
      <div id="single-image-container">
        <img id="single-img" src="" alt="Project Image" style="display:none;">
      </div>
      <div id="video-container">
        <video id="project-video" controls style="display:none;">
          <source id="video-src" src="" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
      <h3 id="modal-title"></h3>
      <p style="font-weight:600; color:#fff;">Tech Stack:</p>
      <div id="modal-tags" class="tags"></div>
      <p style="font-weight:600; color:#fff;">Project Details:</p>
      <ul id="modal-details"></ul>
    </div>
  </div>

  <script>
    const projects = {{ projects|tojson }};
    const galleries = {
      "Advanced Fracture And Tumor Detection System": [
        "{{ url_for('static', filename='images/fracture1.jpg') }}",
        "{{ url_for('static', filename='images/fracture2.jpg') }}",
        "{{ url_for('static', filename='images/fracture3.jpg') }}"
      ],
      "Gym Management System": [
        "{{ url_for('static', filename='images/gym1.png') }}",
        "{{ url_for('static', filename='images/gym2.png') }}",
        "{{ url_for('static', filename='images/gym3.png') }}",
        "{{ url_for('static', filename='images/gym4.png') }}"
      ],
      "Hospital Management System": [
        "{{ url_for('static', filename='images/h1.png') }}",
        "{{ url_for('static', filename='images/h2.png') }}",
        "{{ url_for('static', filename='images/h3.png') }}"
      ]
    };
    const galleryCurrentIndex = {};
    let currentProjectIndex = null;

    function openModal(index) {
      currentProjectIndex = index;
      const proj = projects[index];
      document.getElementById("project-modal").classList.add("show");

      // Title
      document.getElementById("modal-title").textContent = proj.title;

      // Tech Stack
      const tagsContainer = document.getElementById("modal-tags");
      tagsContainer.innerHTML = "";
      proj.stack.forEach(tag => {
        const span = document.createElement("span");
        span.textContent = tag;
        tagsContainer.appendChild(span);
      });

      // Project Details
      const detailsContainer = document.getElementById("modal-details");
      detailsContainer.innerHTML = "";
      proj.details.forEach(bullet => {
        const li = document.createElement("li");
        li.textContent = bullet;
        detailsContainer.appendChild(li);
      });

      // Handle gallery
      if (galleries[proj.title]) {
        galleryCurrentIndex[proj.title] = 0;
        document.getElementById("gallery-img").src = galleries[proj.title][0];
        document.getElementById("gallery-container").style.display = "block";
        document.getElementById("single-img").style.display = "none";
      } else if (proj.img && proj.img.length > 0) {
        document.getElementById("single-img").src = `/static/${proj.img[0]}`;
        document.getElementById("single-img").style.display = "block";
        document.getElementById("gallery-container").style.display = "none";
      } else {
        document.getElementById("gallery-container").style.display = "none";
        document.getElementById("single-img").style.display = "none";
      }

      // Handle video
      if (proj.video) {
        document.getElementById("video-src").src = `/static/${proj.video}`;
        const videoEl = document.getElementById("project-video");
        videoEl.style.display = "block";
        videoEl.load();
      } else {
        document.getElementById("project-video").style.display = "none";
      }
    }

    function closeModal() {
      document.getElementById("project-modal").classList.remove("show");
    }

    function nextImage() {
      const proj = projects[currentProjectIndex];
      if (!galleries[proj.title]) return;
      galleryCurrentIndex[proj.title] = (galleryCurrentIndex[proj.title] + 1) % galleries[proj.title].length;
      document.getElementById("gallery-img").src = galleries[proj.title][galleryCurrentIndex[proj.title]];
    }

    function prevImage() {
      const proj = projects[currentProjectIndex];
      if (!galleries[proj.title]) return;
      galleryCurrentIndex[proj.title] = (galleryCurrentIndex[proj.title] - 1 + galleries[proj.title].length) % galleries[proj.title].length;
      document.getElementById("gallery-img").src = galleries[proj.title][galleryCurrentIndex[proj.title]];
    }

    // Close modal on outside click
    window.addEventListener('click', (e) => {
      const modal = document.getElementById("project-modal");
      if (e.target === modal) modal.classList.remove("show");
    });

    // Close modal on Escape
    window.addEventListener('keydown', (e) => {
      if (e.key === "Escape") closeModal();
    });
  </script>
</body>
</html>
